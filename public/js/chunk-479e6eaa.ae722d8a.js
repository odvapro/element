(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-479e6eaa"],{2520:function(e,t,n){"use strict";n("7f7f");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"detail-popup"},[t("Popup",{attrs:{visible:e.isPopupVisible},on:{"update:visible":function(t){e.isPopupVisible=t}}},[t("Detail",{attrs:{tableCode:e.tableCode,name:e.name,id:e.id,element:e.element,updatedElAt:e.updatedElAt},on:{"update:updatedElAt":function(t){e.updatedElAt=t},"update:updated-el-at":function(t){e.updatedElAt=t},cancel:e.cancel,openDetail:e.openDetail,saveElement:e.saveDetailElement,removeElement:e.removeDetailElement,createElement:e.createDetailElement}})],1)],1)},s=[],a=(n("96cf"),n("3b8d")),l=n("b97e"),r=n("a13b"),o={props:["tableCode","name","id","visible","element"],components:{Detail:l["a"]},mixins:[r["a"]],data:function(){return{updatedElAt:new Date}},computed:{isPopupVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{cancel:function(){this.isPopupVisible=!1},openDetail:function(e){this.$emit("openDetail",e)},saveDetailElement:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.saveElement(t);case 2:if(n=e.sent,n.data.success){e.next=5;break}return e.abrupt("return",this.ElMessage(n.data.message));case 5:this.$emit.apply(this,["saveElement"].concat([t,n])),this.updatedElAt=new Date;case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),createDetailElement:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.createElement(t);case 2:if(n=e.sent,n.data.success){e.next=5;break}return e.abrupt("return",this.ElMessage(n.data.message));case 5:this.$emit.apply(this,["createElement"].concat([t,n]));case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),removeDetailElement:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.removeElement(t);case 2:if(n=e.sent,n.data.success){e.next=5;break}return e.abrupt("return",this.ElMessage(n.data.message));case 5:this.$emit.apply(this,["removeElement"].concat([t,n]));case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},c=o,u=(n("3c52"),n("2877")),d=Object(u["a"])(c,i,s,!1,null,null,null);t["a"]=d.exports},"325c":function(e,t,n){"use strict";n("5c3d")},"3c52":function(e,t,n){"use strict";n("c98e")},"5c3d":function(e,t,n){},a13b:function(e,t,n){"use strict";n("ac6a"),n("96cf");var i=n("3b8d"),s=n("4328"),a=n.n(s);t["a"]={methods:{saveElement:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("saveSelectedElement",t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),createElement:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n,i,s,l,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=this.$store.getters.getPrimaryKeyCode(t.tableCode),i={},e.t0=regeneratorRuntime.keys(t.selectedElement);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,n!=s){e.next=7;break}return e.abrupt("continue",3);case 7:i[s]=t.selectedElement[s],e.next=3;break;case 10:return l=a.a.stringify({insert:{table:t.tableCode,values:[i]}}),e.next=13,this.$axios.post("/el/insert/",l);case 13:return r=e.sent,e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),removeElement:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=this.$store.getters.getPrimaryKeyCode(t.tableCode),e.next=3,this.$store.dispatch("removeRecord",{delete:{table:t.tableCode,where:{operation:"and",fields:[{code:n,operation:"IS",value:t.selectedElement[n]}]}}});case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}}},b97e:function(e,t,n){"use strict";n("7f7f");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"detail"},[t("ConfirmPopup",{attrs:{name:"confirmRemove",buttons:e.confirmDeleteButtons,message:e.removeMessage},on:{confirm:e.onConfirmRemove,cancel:e.onCancelRemove}}),t("div",{staticClass:"detail-head"},[t("div",{staticClass:"detail-head__burger",class:{hidden:e.isShowSidebar}},[t("MobileBurger")],1),t("div",{staticClass:"detail-head-name"},[t("div",{staticClass:"detail-icon-wrapper"},[t("svg",{attrs:{width:"14",height:"13"}},[t("use",{attrs:{"xlink:href":"#tableicon"}})])]),"tableAddElement"!=e.name?[t("div",{staticClass:"detail-name-wrapper"},[t("div",{staticClass:"detail-head-label"},[e._v(e._s(e.$t("pages.table.edit_element")))]),t("div",{staticClass:"detail-head-descr"},[e._v(e._s(e.tableCode))])]),t("div",{staticClass:"detail-head__buttons"},[t("button",{staticClass:"el-gbtn",on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))]),t("button",{staticClass:"el-gbtn",on:{click:e.confirmRemove}},[e._v(e._s(e.$t("remove")))]),t("button",{staticClass:"el-btn",on:{click:e.saveElement}},[e._v(e._s(e.$t("save")))])])]:[t("div",{staticClass:"detail-name-wrapper"},[t("div",{staticClass:"detail-head-label"},[e._v(e._s(e.$t("pages.table.new_element")))]),t("div",{staticClass:"detail-head-descr"},[e._v(e._s(e.tableCode))])]),t("div",{staticClass:"detail-head__buttons"},[t("button",{staticClass:"el-gbtn",on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))]),t("button",{staticClass:"el-btn",on:{click:e.createElement}},[e._v(e._s(e.$t("create")))])])]],2)]),t("div",{staticClass:"detail-feilds"},e._l(e.selectedElement,(function(i,s){return t("div",{key:"selItem".concat(s),staticClass:"detail-feild"},[t("div",{staticClass:"detail-field__name-wrap"},[t("img",{staticClass:"detail-field__icon-image",attrs:{src:n("53a4")("./assets".concat(e.columnEmSettings(s).type_info.iconPath))}}),t("div",{staticClass:"detail-field-name"},[t("span",[e._v(e._s(e.getColumnName(s)))]),t("small",[e._v(e._s(s))])])]),t("div",{staticClass:"detail-field-box"},[e.columns[s]?t("MainField",{attrs:{mode:"edit",view:"detail",fieldName:e.columns[s].em.settings.code,params:{value:i,settings:e.$store.getters.getColumnSettings(e.tableCode,s,e.selectedElement)}},on:{onChange:e.changeFieldValue}}):e._e()],1)])})),0),t("div",{staticClass:"detail__buttons"},["tableAddElement"!=e.name?[t("button",{staticClass:"el-gbtn",on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))]),t("button",{staticClass:"el-gbtn",on:{click:e.confirmRemove}},[e._v(e._s(e.$t("remove")))]),t("button",{staticClass:"el-btn",on:{click:e.saveElement}},[e._v(e._s(e.$t("save")))])]:[t("button",{staticClass:"el-gbtn",on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))]),t("button",{staticClass:"el-btn",on:{click:e.createElement}},[e._v(e._s(e.$t("create")))])]],2)],1)},s=[],a=(n("8e6e"),n("ac6a"),n("456d"),n("96cf"),n("3b8d")),l=n("bd86"),r=n("6e3e"),o=n("25bd"),c=n("2f62");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){Object(l["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={props:["tableCode","name","id","element","updatedElAt"],components:{MainField:r["a"],MobileBurger:o["a"]},computed:d({},Object(c["b"])(["isShowSidebar"])),data:function(){return{columns:{},selectedElement:{},fieldNames:{},removeMessage:this.$t("popups.confirmDeletePopup.remove"),confirmDeleteButtons:{confirm:{text:this.$t("popups.confirmDeletePopup.confirm_delete")},cancel:{text:this.$t("popups.confirmDeletePopup.cancel")}}}},watch:{id:function(e){this.selectedElement.id=e},updatedElAt:function(e){this.selectElement()}},mounted:function(){this.selectElement(),this.fieldNames=Object.assign(this.fieldNames,this.$store.getters.getTableFieldsNames(this.tableCode))},methods:{selectElement:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t={select:{},where:[],order:[]},t.select.from=this.tableCode,n=this.$store.getters.getPrimaryKeyCode(this.tableCode),this.columns=this.$store.getters.getColumns(this.tableCode),"tableAddElement"==this.name||this.element){e.next=11;break}return t.select.where={operation:"and",fields:[{code:n,operation:"IS",value:this.id}]},e.next=8,this.$store.dispatch("selectElement",t);case 8:this.$set(this,"selectedElement",this.$store.state.tables.selectedElement),e.next=12;break;case 11:for(i in this.columns)this.$set(this.selectedElement,i,""),this.$set(this.selectedElement,i,""),this.element&&"undefined"!=typeof this.element[i]&&this.$set(this.selectedElement,i,this.element[i]);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),changeFieldValue:function(e){this.selectedElement[e.settings.fieldCode]=e.value},columnEmSettings:function(e){if("undefined"!=typeof this.columns[e])return this.columns[e].em;throw new Error("No column with code ".concat(e))},getColumnName:function(e){return this.columnEmSettings(e).name||e},saveElement:function(){this.$emit("saveElement",{selectedElement:this.selectedElement,tableCode:this.tableCode})},createElement:function(){this.$emit("createElement",{selectedElement:this.selectedElement,tableCode:this.tableCode})},cancel:function(){this.$emit("cancel")},confirmRemove:function(){this.$modal.show("confirmRemove")},onConfirmRemove:function(){this.remove(),this.$modal.hide("confirmRemove")},onCancelRemove:function(){this.$modal.hide("confirmRemove")},remove:function(){this.$emit("removeElement",{selectedElement:this.selectedElement,tableCode:this.tableCode})}}},h=m,f=(n("d160"),n("2877")),p=Object(f["a"])(h,i,s,!1,null,null,null);t["a"]=p.exports},c98e:function(e,t,n){},d160:function(e,t,n){"use strict";n("f63a")},f2d4:function(e,t,n){"use strict";n.r(t);n("7f7f");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"em-node",class:"true"==e.fieldSettings.disabled?"disabled":""},[t("List",{attrs:{searchText:e.query,settings:{placeholder:e.$t("empty")},multiple:"true"===e.fieldSettings.multiple},on:{"update:searchText":function(t){e.query=t},"update:search-text":function(t){e.query=t},onopen:function(t){return e.getNodes()}},scopedSlots:e._u([{key:"selected",fn:function(){return e._l(e.selectedItems,(function(n){return t("ListOption",{key:n.id,staticClass:"em-node__tag",attrs:{current:!0},on:{remove:function(t){return e.removeItem(n)}},nativeOn:{click:function(t){return t.stopPropagation(),e.openNodePage(n)}}},[e._v(e._s(n.name))])}))},proxy:!0}])},[e._l(e.list,(function(n){return t("ListOption",{key:n.code,on:{select:function(t){return e.selectItem(n)}}},[e._v(e._s(n.name))])})),e.newTag?t("div",{staticClass:"em-node__footer",on:{click:function(t){return e.createItem()}}},[t("div",{staticClass:"em-node__btn"},[e._v(" "+e._s(e.$t("create"))+" ")]),t("div",{staticClass:"em-node__new-tag"},[e._v(" "+e._s(e.newTag)+" ")])]):e._e()],2),t("DetailPopup",{attrs:{visible:e.showDetail,tableCode:e.detailTableCode,name:e.detailName,element:e.currentElement},on:{"update:visible":function(t){e.showDetail=t},createElement:e.createElement}}),t("DetailPopup",{attrs:{visible:e.showDetailInfo,tableCode:e.detailTableCode,name:e.detailName,id:e.detailInfoId},on:{"update:visible":function(t){e.showDetailInfo=t}}})],1)},s=[],a=(n("96cf"),n("3b8d")),l=n("2520"),r={components:{DetailPopup:l["a"]},props:["fieldValue","fieldSettings","mode","view"],data:function(){return{detailTableCode:!1,detailName:!1,showDetail:!1,showDetailInfo:!1,currentElement:!1,list:[],query:"",localFieldValue:this.fieldValue,storableData:[],newTag:"",nodesTimeout:"",detailInfoId:!1}},watch:{query:function(e){this.newTag=this.query,this.getNodes()}},computed:{selectedItems:function(){return this.localFieldValue&&this.localFieldValue.length?this.localFieldValue:[]}},methods:{openNodePage:function(e){this.detailTableCode=this.fieldSettings.nodeTableCode,this.detailName=e.name,this.detailInfoId=e.primaryKey,this.showDetailInfo=!0},createElement:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:1==n.data.success?(i={},i["id"]=n.data.lastid,i[this.fieldSettings.nodeSearchCode]=this.newTag,this.selectItem(i),this.ElMessage(this.$t("elMessages.element_created")),this.showDetail=!1):this.ElMessage.error(this.$t("elMessages.cant_create_element"));case 1:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}(),bindDefaultColumnValues:function(){this.currentElement=[];var e=this.$store.getters.getTable(this.fieldSettings.nodeTableCode);for(var t in e.columns)this.currentElement[t]="";this.currentElement[this.fieldSettings.nodeSearchCode]=this.newTag},popupForCreateElement:function(){this.bindDefaultColumnValues(),this.detailTableCode=this.fieldSettings.nodeTableCode,this.detailName="tableAddElement",this.showDetail=!0},getNodes:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:clearTimeout(this.nodesTimeout),this.nodesTimeout=setTimeout(Object(a["a"])(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new FormData,n.append("nodeFieldCode",t.fieldSettings.nodeFieldCode),n.append("nodeTableCode",t.fieldSettings.nodeTableCode),n.append("nodeSearchCode",t.fieldSettings.nodeSearchCode),n.append("q",t.query),"false"!=t.fieldSettings.useFilter&&void 0!=t.fieldSettings.filters&&n.append("filters",JSON.stringify(t.fieldSettings.filters)),e.next=8,t.$axios({method:"POST",data:n,headers:{"Content-Type":"multipart/form-data"},url:"/field/em_node/index/autoComplete/"});case 8:if(i=e.sent,i.data.success){e.next=11;break}return e.abrupt("return",!1);case 11:t.list=i.data.result;case 12:case"end":return e.stop()}}),e)}))),1e3);case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),createItem:function(){this.popupForCreateElement()},selectItem:function(e){this.localFieldValue instanceof Array||(this.localFieldValue=[]),-1===this.localFieldValue.indexOf(e)&&("true"===this.fieldSettings.multiple?this.localFieldValue.push(e):this.localFieldValue=[e],this.$emit("onChange",{value:this.localFieldValue,settings:this.fieldSettings}))},removeItem:function(e){if("true"===this.fieldSettings.multiple){var t=this.localFieldValue.indexOf(e);this.localFieldValue.splice(t,1)}else this.localFieldValue="";this.$emit("onChange",{value:this.localFieldValue,settings:this.fieldSettings})}}},o=r,c=(n("325c"),n("2877")),u=Object(c["a"])(o,i,s,!1,null,null,null);t["default"]=u.exports},f63a:function(e,t,n){}}]);
//# sourceMappingURL=chunk-479e6eaa.ae722d8a.js.map